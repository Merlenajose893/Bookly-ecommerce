<!-- <%- include('../../views/partials/header',{genres:genres}) -%> -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>EShopper - Bootstrap Shop Template</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="Free HTML Templates" name="keywords" />
    <meta content="Free HTML Templates" name="description" />

    <!-- Favicon -->
    <link href="img/favicon.io" rel="icon" />

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="/css/style.css">
    <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet"> -->
  
    <style>
      .dropdown-menu {
  display: none;
}
.dropdown-menu.show {
  display: block;
}
.carousel-item {
            height: 300px;
            overflow: hidden;
            position: relative;
        }

        .carousel-caption {
            padding: 2rem;
            bottom: 50%;
            transform: translateY(50%);
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .carousel-title {
            font-size: 1.2rem;
            letter-spacing: 2px;
            animation: fadeInDown 1s;
        }

        .carousel-heading {
            font-size: 3.5rem;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 1s;
        }

        .shop-btn {
            background: #ffffff;
            color: #000000;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-top: 20px;
            border: 2px solid #ffffff;
        }

        .shop-btn:hover {
            background: transparent;
            color: #ffffff;
        }

        .carousel-control-prev,
        .carousel-control-next {
            width: 45px;
            height: 45px;
            background: #000;
            border-radius: 0;
            top: 50%;
            transform: translateY(-50%);
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

    </style>
  </head>

  <body>
    <!-- Topbar Start -->
    <div class="container-fluid">
    
   
      
      <div class="row bg-secondary py-2 px-xl-5">
        <div class="col-lg-6 d-none d-lg-block">
          
          <div class="d-inline-flex align-items-center">
            <a class="text-dark" href="">FAQs</a>
            <span class="text-muted px-2">|</span>
            <a class="text-dark" href="">Help</a>
            <span class="text-muted px-2">|</span>
            <a class="text-dark" href="">Support</a>
           
            
            
          
            
          </div>
         
        </div>
        <div class="col-lg-6 text-center text-lg-right">
          <div class="d-inline-flex align-items-center">
            <a class="text-dark px-2" href="">
              <i class="fab fa-facebook-f"></i>
            </a>
            <a class="text-dark px-2" href="">
              <i class="fab fa-twitter"></i>
            </a>
            <a class="text-dark px-2" href="">
              <i class="fab fa-linkedin-in"></i>
            </a>
            <a class="text-dark px-2" href="">
              <i class="fab fa-instagram"></i>
            </a>
            <a class="text-dark pl-2" href="">
              <i class="fab fa-youtube"></i>
            </a>
          </div>
        </div>
      </div>
      <div class="row align-items-center py-3 px-xl-5">
        <div class="col-lg-3 d-none d-lg-block">
          <a href="" class="text-decoration-none">
            <h1 class="m-0 display-5 font-weight-semi-bold">
              <span class="text-primary font-weight-bold border px-3 mr-1">B</span>OOKLY
            </h1>
          </a>
        </div>
        <div class="col-lg-6 col-6 text-left">
          <form action="/" method="get">
            <div class="input-group">
              <input type="text" class="form-control" placeholder="Search for Books" name="search" value="<%=searchQuery%>" />
              <div class="input-group-append">
                <span class="input-group-text bg-transparent text-primary">
                 
                  <!-- <i class="fa fa-search"></i> -->
                  <button type="submit" style="background-color:#D19C97;">Search</button>
                </span>
              </div>
            </div>
            
          <!-- </form> -->
          
          </form>
        </div>
        
        <div class="col-lg-3 col-6 text-right">
          <div class="dropdown">
            <a 
              class="btn border" 
              href="#" 
              role="button" 
              id="profileDropdown" 
              onclick="toggleDropdown(event)">
              <i class="fa fa-user" aria-hidden="true"></i>
              <span class="badge">0</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
              <li class="dropdown-header"> <%= userLogged && userLogged.name ? userLogged.name : (userLogged ? 'User (No name available)' : 'Guest') %></li>
              <li><a class="dropdown-item" href="/profiledashboard">Profile Dashboard</a></li>
             
            </ul>
            <a href="/wishlist" class="btn border">
              <i class="fas fa-heart text-primary"></i>
              <span class="badge">0</span>
            </a>
            <a href="/cart" class="btn border">
              <i class="fas fa-shopping-cart text-primary"></i>
              <span class="badge">0</span>
            </a>
          </div>
         
          
          
        </div>
      </div>
    </div>
    <!-- Topbar End -->

    <!-- Navbar Start -->
    <div class="container-fluid mb-5">
      <div class="row border-top px-xl-5">
        <div class="col-lg-3 d-none d-lg-block">
          <a
            class="btn shadow-none d-flex align-items-center justify-content-between bg-primary text-white w-100"
            data-toggle="collapse"
            href="#navbar-vertical"
            style="height: 65px; margin-top: -1px; padding: 0 30px"
          >
            <h6 class="m-0">Categories</h6>
            <i class="fa fa-angle-down text-dark"></i>
          </a>
          <nav class="collapse position-absolute navbar navbar-vertical navbar-light align-items-start p-0 border border-top-0 border-bottom-0 bg-light" id="navbar-vertical" style="width: calc(100% - 30px); z-index: 1;">
            <div class="navbar-nav w-100 overflow-hidden" style="height: 410px">
              <div class="nav-item dropdown">
                <a href="#" class="nav-link" data-toggle="dropdown">Genres <i class="fa fa-angle-down float-right mt-1"></i></a>
               <div class="dropdown-menu position-absolute bg-secondary border-0 rounded-0 w-100 m-0" style="max-height: 300px; overflow-y: auto;">
    <% if (genres && genres.length) { %>
        <% genres.forEach(genre => { %>
            <% if (!genre.isDeleted) { %> <!-- Check if genre is not deleted -->
                <a href="/genres/<%= genre._id %>" class="dropdown-item">
                    <%= genre.name %>
                </a>
            <% } %>
        <% }); %>
    <% } else { %>
        <p class="dropdown-item">No genres available</p>
    <% } %>
</div>

            </div>
            
        </nav>
        </div>
        <div class="col-lg-9">
          <nav class="navbar navbar-expand-lg bg-light navbar-light py-3 py-lg-0 px-0">
            <a href="" class="text-decoration-none d-block d-lg-none">
              <h1 class="m-0 display-5 font-weight-semi-bold">
                <span class="text-primary font-weight-bold border px-3 mr-1">B</span>OOKLY
              </h1>
            </a>
            <button
              type="button"
              class="navbar-toggler"
              data-toggle="collapse"
              data-target="#navbarCollapse"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
              <div class="navbar-nav mr-auto py-0">
                <a href="/" class="nav-item nav-link active">Home</a>
                <a href="/shop" class="nav-item nav-link">Shop</a>
                <a href="" class="nav-item nav-link">Genres</a>
                <div class="nav-item dropdown">
                  
                
                <!-- Debugging output -->
               
                

                  <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Pages</a>
                  <div class="dropdown-menu rounded-0 m-0">
                    <a href="/cart" class="dropdown-item">Shopping Cart</a>
                    <a href="/checkout" class="dropdown-item">Checkout</a>
                  </div>
                </div>
                <a href="/contact" class="nav-item nav-link">Contact</a>
                <!-- <a href="/contact" class="nav-item nav-link">About</a> -->
              </div>
              <div class="col-lg-3 col-6 text-right">
        
                <% if (isAuthenticated) { %>
                    <a href="/logout" class="btn border">
                        <i class="fas fa-sign-out-alt text-primary"></i>
                       
                        <span>Logout</span>
                    </a>
                <% } else { %>
                    <a href="/login" class="btn border">
                        <i class="fas fa-sign-in-alt text-primary"></i>
                        <span>Login</span>
                    </a>
                <% } %>
            </div>
            
              
            

              
            </div>
          </nav>
          <div id="header-carousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="/img/carousel-1.jpg" class="w-100 h-100 object-fit-cover" alt="Books Collection">
                    <div class="carousel-caption d-flex flex-column align-items-center justify-content-center">
                        <h4 class="text-light text-uppercase font-weight-medium mb-3">
                            10% Off Your First Order
                        </h4>
                        <h3 class="display-4 text-white font-weight-semi-bold mb-4">
                            Wide Range Of Books
                        </h3>
                        <a href="#" class="shop-btn">Shop Now</a>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="/img/carousel-2.jpg" class="w-100 h-100 object-fit-cover" alt="Books Discount">
                    <div class="carousel-caption d-flex flex-column align-items-center justify-content-center">
                        <h4 class="text-light text-uppercase font-weight-medium mb-3">
                            10% Off Your First Order
                        </h4>
                        <h3 class="display-4 text-white font-weight-semi-bold mb-4">
                            Reasonable Price
                        </h3>
                        <a href="/shop" class="shop-btn">Shop Now</a>
                    </div>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#header-carousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#header-carousel" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
            </button>
        </div>
        </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
   
    
  


    <!-- Navbar End -->
    <% if (message) { %>
        <div class="alert alert-danger" style="background-color: red; color: white; padding: 10px; text-align: center;">
            <h3><%= message %></h3>
        </div>
    <% } %>
   
    

    <!-- Featured Start -->
    <div class="container-fluid pt-5">
        <div class="row px-xl-5 pb-3">
            <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
                <div class="d-flex align-items-center border mb-4" style="padding: 30px;">
                    <h1 class="fa fa-check text-primary m-0 mr-3"></h1>
                    <h5 class="font-weight-semi-bold m-0">Wide Range Of Books</h5>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
                <div class="d-flex align-items-center border mb-4" style="padding: 30px;">
                    <h1 class="fa fa-shipping-fast text-primary m-0 mr-2"></h1>
                    <h5 class="font-weight-semi-bold m-0">Free Shipping</h5>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
                <div class="d-flex align-items-center border mb-4" style="padding: 30px;">
                    <h1 class="fas fa-exchange-alt text-primary m-0 mr-3"></h1>
                    <h5 class="font-weight-semi-bold m-0">Easy Refunds and Returns</h5>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
                <div class="d-flex align-items-center border mb-4" style="padding: 30px;">
                    <h1 class="fa fa-phone-volume text-primary m-0 mr-3"></h1>
                    <h5 class="font-weight-semi-bold m-0">24/7 Support</h5>
                </div>
            </div>
        </div>
    </div>
    <!-- Featured End -->


    <!-- Categories Start -->
    <!-- Categories Start -->
<!-- Categories Start -->



    
    <!-- Categories End -->


    <!-- Offer Start -->
   
    <!-- Offer End -->


    <!-- Books Start -->
    <div class="container-fluid pt-5">
        <div class="text-center mb-4">
            <h2 class="section-title px-5"><span class="px-2">Hot-Picks</span></h2>
        </div>
        <div class="row px-xl-5 pb-3">
            <% books.slice(0,4).forEach(function(book) { %>
                <div class="col-lg-3 col-md-4 col-sm-6 pb-1"> <!-- Reduced column sizes -->
                    <div class="card product-item border-0 mb-4" style="max-width: 280px; margin: 0 auto;"> <!-- Added max-width and center alignment -->
                        <!-- Product Image -->
                        <div class="card-header product-img position-relative overflow-hidden bg-transparent border p-0">
                            <% if (book.images && book.images.length > 0) { %>
                                <img 
                                    class="img-fluid w-100" 
                                    src="/uploads/<%= book.images[0].split('/').pop() %>" 
                                    alt="<%= book.title %>"
                                    style="height: 200px; object-fit: contain;" 
                                >
                            <% } else { %>
                                <img 
                                    class="img-fluid w-100" 
                                    src="/path/to/placeholder.jpg" 
                                    alt="Placeholder Image"
                                    style="height: 200px; object-fit: contain;"
                                >
                            <% } %>
                        </div>
        
                        <!-- Product Details -->
                        <div class="card-body border-left border-right text-center p-0 pt-3 pb-2"> <!-- Reduced padding -->
                            <h6 class="text-truncate mb-2 px-3"> <!-- Added horizontal padding -->
                                <%= book.title %>
                            </h6>
                            <p class="mb-2 small"> <!-- Added 'small' class for author name -->
                                <%= book.author %>
                            </p>
                            
                            <!-- Price Section -->
                            <div class="d-flex justify-content-center align-items-center mb-2">
                                <h6 class="mr-2 mb-0">$<%= book.regularPrice %></h6>
                                <h6 class="text-muted mb-0">
                                    <del>$<%= book.salesPrice %></del>
                                </h6>
                            </div>
                        </div>
        
                        <!-- Action Buttons -->
                        <div class="card-footer d-flex justify-content-between bg-light border py-2"> <!-- Reduced padding -->
                            <a href="/book/<%= book._id %>" class="btn btn-sm text-dark p-0">
                                <i class="fas fa-eye text-primary mr-1"></i>
                                <span class="small">View Detail</span> <!-- Added 'small' class -->
                            </a>
                            <a href="#" class="btn btn-sm text-dark p-0">
                                <i class="fas fa-shopping-cart text-primary mr-1"></i>
                                <span class="small">Add To Cart</span> <!-- Added 'small' class -->
                            </a>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
    </div>
    <!-- Books End -->


    <!-- Subscribe Start -->

    <!-- Subscribe End -->


    <!-- Books Start -->
  
    <div class="container-fluid pt-5">
        <div class="text-center mb-4">
            <h2 class="section-title px-5"><span class="px-2">New-Picks</span></h2>
        </div>
        <div class="row px-xl-5 pb-3">
            <% books.slice(5, 9).forEach(function(book) { %>
                <div class="col-lg-3 col-md-4 col-sm-6 pb-1"> <!-- Reduced column sizes -->
                    <div class="card product-item border-0 mb-4" style="max-width: 280px; margin: 0 auto;"> <!-- Added max-width and center alignment -->
                        <!-- Product Image -->
                        <div class="card-header product-img position-relative overflow-hidden bg-transparent border p-0">
                            <% if (book.images && book.images.length > 0) { %>
                                <img 
                                    class="img-fluid w-100" 
                                    src="/uploads/<%= book.images[0].split('/').pop() %>" 
                                    alt="<%= book.title %>"
                                    style="height: 200px; object-fit: contain;"
                                >
                            <% } else { %>
                                <img 
                                    class="img-fluid w-100" 
                                    src="/path/to/placeholder.jpg" 
                                    alt="Placeholder Image"
                                    style="height: 200px; object-fit: contain;"
                                >
                            <% } %>
                        </div>
        
                        <!-- Product Details -->
                        <div class="card-body border-left border-right text-center p-0 pt-3 pb-2"> <!-- Reduced padding -->
                            <h6 class="text-truncate mb-2 px-3"> <!-- Added horizontal padding -->
                                <%= book.title %>
                            </h6>
                            <p class="mb-2 small"> <!-- Added 'small' class for author name -->
                                <%= book.author %>
                            </p>
                            
                            <!-- Price Section -->
                            <div class="d-flex justify-content-center align-items-center mb-2">
                                <h6 class="mr-2 mb-0">$<%= book.regularPrice %></h6>
                                <h6 class="text-muted mb-0">
                                    <del>$<%= book.salesPrice %></del>
                                </h6>
                            </div>
                        </div>
        
                        <!-- Action Buttons -->
                        <div class="card-footer d-flex justify-content-between bg-light border py-2"> <!-- Reduced padding -->
                            <a href="/book/<%= book._id %>" class="btn btn-sm text-dark p-0">
                                <i class="fas fa-eye text-primary mr-1"></i>
                                <span class="small">View Detail</span> <!-- Added 'small' class -->
                            </a>
                            <a href="#" class="btn btn-sm text-dark p-0">
                                <i class="fas fa-shopping-cart text-primary mr-1"></i>
                                <span class="small">Add To Cart</span> <!-- Added 'small' class -->
                            </a>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
    </div>
    <!-- Books End -->


    <!-- Vendor Start -->
    <div class="container-fluid py-5">
        <div class="row px-xl-5">
            <div class="col">
                <div class="owl-carousel vendor-carousel">
                    <div class="vendor-item border p-4">
                        <img src="img/logo-1.png" alt="">
                    </div>
                    <div class="vendor-item border p-4">
                        <img src="img/P2 1.png" alt="">
                    </div>
                    <div class="vendor-item border p-4">
                        <img src="img/logo-2.jpg" alt="">
                    </div>
                    <div class="vendor-item border p-4">
                        <img src="img/logo-3.png" alt="">
                    </div>
                    <div class="vendor-item border p-4">
                        <img src="img/P3 1.png" alt="">
                    </div>
                    <div class="vendor-item border p-4">
                        <img src="img/logo-4.png" alt="">
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
    <!-- Vendor End -->


    <!-- Footer Start -->
   <%-include('../../views/partials/footer.js')%>
    <!-- Footer End -->


    <!-- Back to Top -->
    <a href="#" class="btn btn-primary back-to-top"><i class="fa fa-angle-double-up"></i></a>


    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Contact Javascript File -->
    <script src="mail/jqBootstrapValidation.min.js"></script>
    <script src="mail/contact.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>
    <script>
        function toggleDropdown(event) {
    event.preventDefault(); // Prevent default link behavior
    const dropdown = event.target.closest('.dropdown'); // Find the closest dropdown container
    const menu = dropdown.querySelector('.dropdown-menu'); // Find the dropdown menu
  
    if (menu.classList.contains('show')) {
      menu.classList.remove('show'); // Close the dropdown if it's open
    } else {
      menu.classList.add('show'); // Open the dropdown
    }
  }
  
      </script>
      <script>
        document.getElementById("searchForm").addEventListener("submit", async function (event) {
            event.preventDefault(); // Prevent page refresh
            const query = document.getElementById("searchInput").value.trim(); // Get search text
    
            if (query) {
                try {
                    const response = await fetch(`/search?query=${searchQuery}`); // Send search request
                    const data = await response.json();
    
                    if (data.bookId) {
                        window.location.href = `/book/${data.id}`; // Redirect to book details page
                    } else {
                        alert("Book not found!"); // Show alert if book not found
                    }
                } catch (error) {
                    console.error("Error searching for book:", error);
                }
            }
        });
    </script>
    <script>
      document.getElementById("searchForm").addEventListener("submit", function(event) {
          event.preventDefault();
          
          let searchQuery = document.getElementById("searchInput").value.trim();
          
          if (searchQuery) {
              fetch(`/check-category?search=${searchQuery}`)
                  .then(response => response.json())
                  .then(data => {
                      if (data.isCategory) {
                          window.location.href = `/genres/${data.categoryId}`; // Redirects to the correct route
                      } else {
                          window.location.href = `/?search=${encodeURIComponent(searchQuery)}`;
                      }
                  })
                  .catch(error => console.error("Error:", error));
          }
      });
      </script>
</body>

</html>